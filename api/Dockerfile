FROM node:14.15.0-alpine3.10

WORKDIR /app

COPY package.json package.lock*.json ./

RUN npm i --quiet && npm cache clean --force

COPY . .

ARG SERVER_PORT
ARG JWT_SECRET
ARG JWT_EXPIRE
ARG REDIS_HOST
ARG REDIS_PORT
ARG DATABASE_HOST
ARG DATABASE_PORT
ARG DATABASE_NAME
ARG DATABASE_USER
ARG DATABASE_PASSWORD


ENV SERVER_PORT $SERVER_PORT
ENV JWT_SECRET $JWT_SECRET
ENV JWT_EXPIRE $JWT_EXPIRE
ENV REDIS_HOST $REDIS_HOST
ENV REDIS_PORT $REDIS_PORT
ENV DATABASE_HOST $DATABASE_HOST
ENV DATABASE_PORT $DATABASE_PORT
ENV DATABASE_NAME $DATABASE_NAME
ENV DATABASE_USER $DATABASE_USER
ENV DATABASE_PASSWORD $DATABASE_PASSWORD

EXPOSE 3000

CMD ["npm", "run", "start:debug"]